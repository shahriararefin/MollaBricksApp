{% extends "base.html" %}

{% block title %}Sales History{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>Sales History</h2>
  <a href="{{ url_for('sales.add_form') }}" class="btn btn-success">Add New Sale</a>
</div>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

<div class="table-responsive">
  <table class="table table-hover table-striped">
    <thead>
      <tr>
        <th>ID</th>
        <th>Date</th>
        <th>Chalan No</th>
        <th>Customer Name</th>
        <th>Brick Amount</th>
        <th>Total (BDT)</th>
        <th>Paid (BDT)</th>
        <th>Due (BDT)</th>
        <th>Actions</th> </tr>
    </thead>
    <tbody>
      {% for sale in sales %}
        <tr class="{% if sale[7] > 0 %} table-danger {% endif %}">
          <td>{{ sale[0] }}</td>
          <td>{{ sale[1] }}</td>
          <td>{{ sale[2] }}</td>
          <td>{{ sale[3] }}</td>
          <td>{{ sale[4] }}</td>
          <td>{{ "%.2f"|format(sale[5]) }}</td>
          <td>{{ "%.2f"|format(sale[6]) }}</td>
          <td>{{ "%.2f"|format(sale[7]) }}</td>
          <td>
            <a href="{{ url_for('sales.print_chalan', sale_id=sale[0]) }}" class="btn btn-info btn-sm" target="_blank">Print</a>
            <a href="{{ url_for('sales.edit_sale_form', sale_id=sale[0]) }}" class="btn btn-warning btn-sm">Edit</a>
            <form action="{{ url_for('sales.delete_sale', sale_id=sale[0]) }}" method="POST" style="display: inline;" onsubmit="return confirm('Are you sure? This will also delete linked ledger entries.');">
                <button type="submit" class="btn btn-danger btn-sm">Delete</button>
            </form>
          </td>
        </tr>
      {% else %}
        <tr>
          <td colspan="9" class="text-center">No sales found.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}